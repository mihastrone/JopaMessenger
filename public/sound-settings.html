<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Настройки звуков Jopa Messenger</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            text-align: center;
            color: #1e88e5;
            margin-top: 0;
        }
        
        h2 {
            color: #0d47a1;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
            margin-top: 30px;
        }
        
        .setting-group {
            margin-bottom: 20px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .setting-label {
            flex: 1;
            font-weight: 500;
        }
        
        .setting-control {
            flex: 2;
        }
        
        /* Toggle switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #1e88e5;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* Volume slider */
        .volume-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1e88e5;
            cursor: pointer;
        }
        
        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1e88e5;
            cursor: pointer;
        }
        
        /* Sound selectors */
        .sound-select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
            background-color: white;
        }
        
        /* Custom sound upload */
        .custom-sound-row {
            margin-top: 10px;
            display: flex;
            align-items: center;
        }
        
        .file-input-container {
            position: relative;
            flex: 3;
        }
        
        .file-input {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 8px 12px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            width: calc(100% - 90px);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .play-button {
            margin-left: 10px;
            background-color: #1e88e5;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
            flex: 1;
        }
        
        .play-button:hover {
            background-color: #1565c0;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .save-button, .back-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .save-button {
            background-color: #4caf50;
            color: white;
        }
        
        .save-button:hover {
            background-color: #388e3c;
        }
        
        .back-button {
            background-color: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .back-button:hover {
            background-color: #e0e0e0;
        }
        
        .file-name {
            margin-left: 10px;
            font-size: 0.9em;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .info-box {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .info-box h3 {
            margin-top: 0;
            color: #1e88e5;
        }
        
        .info-box p {
            margin-bottom: 10px;
        }
        
        .info-box ol {
            margin-left: 20px;
            padding-left: 0;
        }
        
        .info-box li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Настройки звуков</h1>
        
        <div class="info-box">
            <h3>Как добавить звуки</h3>
            <p>Для работы звуковых уведомлений, необходимо:</p>
            <ol>
                <li>Создать папку <code>sounds</code> в директории <code>public</code> вашего проекта</li>
                <li>Добавить в эту папку файлы MP3 со следующими именами:
                    <ul>
                        <li><code>send-1.mp3</code>, <code>send-2.mp3</code>, <code>send-3.mp3</code> - для звуков отправки</li>
                        <li><code>receive-1.mp3</code>, <code>receive-2.mp3</code>, <code>receive-3.mp3</code> - для звуков получения</li>
                    </ul>
                </li>
                <li>Вы также можете загрузить свой собственный звук, выбрав опцию "Пользовательский звук"</li>
            </ol>
            <p>Звуковые файлы можно найти на сайтах бесплатных звуковых эффектов, например <a href="https://freesound.org" target="_blank">freesound.org</a> или <a href="https://mixkit.co/free-sound-effects/" target="_blank">mixkit.co</a>.</p>
        </div>
        
        <div class="setting-group">
            <div class="setting-row">
                <div class="setting-label">Включить звуки</div>
                <div class="setting-control">
                    <label class="switch">
                        <input type="checkbox" id="sound-enabled" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">Громкость</div>
                <div class="setting-control">
                    <input type="range" min="0" max="1" step="0.1" value="0.7" class="volume-slider" id="volume-control">
                </div>
            </div>
        </div>
        
        <h2>Звук отправки сообщения</h2>
        <div class="setting-group">
            <div class="setting-row">
                <div class="setting-label">Выберите звук</div>
                <div class="setting-control">
                    <select id="send-sound-select" class="sound-select">
                        <option value="send-1.mp3">Звук 1</option>
                        <option value="send-2.mp3">Звук 2</option>
                        <option value="send-3.mp3">Звук 3</option>
                        <option value="custom">Пользовательский звук</option>
                    </select>
                </div>
            </div>
            
            <div class="custom-sound-row" id="send-custom-container">
                <div class="file-input-container">
                    <div class="file-input-label">Выберите файл</div>
                    <input type="file" accept="audio/*" class="file-input" id="send-custom-file">
                </div>
                <button class="play-button" id="play-send-button">▶</button>
            </div>
        </div>
        
        <h2>Звук получения сообщения</h2>
        <div class="setting-group">
            <div class="setting-row">
                <div class="setting-label">Выберите звук</div>
                <div class="setting-control">
                    <select id="receive-sound-select" class="sound-select">
                        <option value="receive-1.mp3">Звук 1</option>
                        <option value="receive-2.mp3">Звук 2</option>
                        <option value="receive-3.mp3">Звук 3</option>
                        <option value="custom">Пользовательский звук</option>
                    </select>
                </div>
            </div>
            
            <div class="custom-sound-row" id="receive-custom-container">
                <div class="file-input-container">
                    <div class="file-input-label">Выберите файл</div>
                    <input type="file" accept="audio/*" class="file-input" id="receive-custom-file">
                </div>
                <button class="play-button" id="play-receive-button">▶</button>
            </div>
        </div>
        
        <div class="buttons">
            <button class="back-button" id="back-button">Назад</button>
            <button class="save-button" id="save-button">Сохранить</button>
        </div>
    </div>
    
    <script>
        // Текущие настройки звука
        let soundSettings = {
            enabled: true,
            volume: 0.7,
            sendSound: 'send-1.mp3',
            receiveSound: 'receive-1.mp3',
            sendCustomSound: null,
            receiveCustomSound: null
        };
        
        // Загрузка сохраненных настроек
        function loadSavedSettings() {
            const savedSettings = localStorage.getItem('soundSettings');
            if (savedSettings) {
                try {
                    soundSettings = JSON.parse(savedSettings);
                    
                    // Обновление интерфейса
                    document.getElementById('sound-enabled').checked = soundSettings.enabled;
                    document.getElementById('volume-control').value = soundSettings.volume;
                    
                    const sendSelect = document.getElementById('send-sound-select');
                    if (soundSettings.sendSound === 'custom') {
                        sendSelect.value = 'custom';
                        // Обновление имени пользовательского файла, если есть
                        if (soundSettings.sendCustomSound) {
                            const fileName = soundSettings.sendCustomSound.split('/').pop();
                            document.querySelector('#send-custom-container .file-input-label').textContent = fileName;
                        }
                    } else {
                        sendSelect.value = soundSettings.sendSound;
                    }
                    
                    const receiveSelect = document.getElementById('receive-sound-select');
                    if (soundSettings.receiveSound === 'custom') {
                        receiveSelect.value = 'custom';
                        // Обновление имени пользовательского файла, если есть
                        if (soundSettings.receiveCustomSound) {
                            const fileName = soundSettings.receiveCustomSound.split('/').pop();
                            document.querySelector('#receive-custom-container .file-input-label').textContent = fileName;
                        }
                    } else {
                        receiveSelect.value = soundSettings.receiveSound;
                    }
                    
                    // Обновляем видимость контейнеров для пользовательских звуков
                    updateCustomSoundContainers();
                    
                } catch (e) {
                    console.error('Ошибка при загрузке настроек звука:', e);
                }
            }
        }
        
        // Сохранение настроек
        function saveSettings() {
            soundSettings.enabled = document.getElementById('sound-enabled').checked;
            soundSettings.volume = parseFloat(document.getElementById('volume-control').value);
            soundSettings.sendSound = document.getElementById('send-sound-select').value;
            soundSettings.receiveSound = document.getElementById('receive-sound-select').value;
            
            // Сохранение в localStorage
            localStorage.setItem('soundSettings', JSON.stringify(soundSettings));
            
            // Обновление настроек в основном окне
            if (window.opener && !window.opener.closed) {
                try {
                    window.opener.updateSoundSettings(soundSettings);
                    alert('Настройки сохранены');
                    window.close();
                } catch (e) {
                    console.error('Ошибка при обновлении настроек в основном окне:', e);
                    alert('Настройки сохранены, но не удалось обновить их в основном окне. Пожалуйста, перезагрузите страницу чата.');
                }
            } else {
                alert('Настройки сохранены. Пожалуйста, перезагрузите страницу чата для применения изменений.');
                window.close();
            }
        }
        
        // Обновление видимости контейнеров для пользовательских звуков
        function updateCustomSoundContainers() {
            const sendCustomContainer = document.getElementById('send-custom-container');
            sendCustomContainer.style.display = document.getElementById('send-sound-select').value === 'custom' ? 'flex' : 'none';
            
            const receiveCustomContainer = document.getElementById('receive-custom-container');
            receiveCustomContainer.style.display = document.getElementById('receive-sound-select').value === 'custom' ? 'flex' : 'none';
        }
        
        // Воспроизведение выбранного звука отправки
        function playSelectedSendSound() {
            const soundSelect = document.getElementById('send-sound-select');
            const volume = parseFloat(document.getElementById('volume-control').value);
            
            let soundPath;
            if (soundSelect.value === 'custom') {
                if (soundSettings.sendCustomSound) {
                    soundPath = soundSettings.sendCustomSound;
                } else {
                    alert('Пожалуйста, выберите пользовательский звук');
                    return;
                }
            } else {
                soundPath = `../sounds/${soundSelect.value}`;
            }
            
            const audio = new Audio(soundPath);
            audio.volume = volume;
            audio.play().catch(error => {
                console.error('Ошибка воспроизведения звука:', error);
                alert('Не удалось воспроизвести звук. Возможно, формат файла не поддерживается или звуковой файл не найден.');
            });
        }
        
        // Воспроизведение выбранного звука получения
        function playSelectedReceiveSound() {
            const soundSelect = document.getElementById('receive-sound-select');
            const volume = parseFloat(document.getElementById('volume-control').value);
            
            let soundPath;
            if (soundSelect.value === 'custom') {
                if (soundSettings.receiveCustomSound) {
                    soundPath = soundSettings.receiveCustomSound;
                } else {
                    alert('Пожалуйста, выберите пользовательский звук');
                    return;
                }
            } else {
                soundPath = `../sounds/${soundSelect.value}`;
            }
            
            const audio = new Audio(soundPath);
            audio.volume = volume;
            audio.play().catch(error => {
                console.error('Ошибка воспроизведения звука:', error);
                alert('Не удалось воспроизвести звук. Возможно, формат файла не поддерживается или звуковой файл не найден.');
            });
        }
        
        // Обработка выбора пользовательского звука отправки
        function handleSendCustomFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                // Обновляем текст с именем файла
                document.querySelector('#send-custom-container .file-input-label').textContent = file.name;
                
                // Создаем URL для файла и сохраняем его
                soundSettings.sendCustomSound = URL.createObjectURL(file);
            }
        }
        
        // Обработка выбора пользовательского звука получения
        function handleReceiveCustomFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                // Обновляем текст с именем файла
                document.querySelector('#receive-custom-container .file-input-label').textContent = file.name;
                
                // Создаем URL для файла и сохраняем его
                soundSettings.receiveCustomSound = URL.createObjectURL(file);
            }
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            // Загрузка сохраненных настроек
            loadSavedSettings();
            
            // Обработчики событий
            document.getElementById('send-sound-select').addEventListener('change', updateCustomSoundContainers);
            document.getElementById('receive-sound-select').addEventListener('change', updateCustomSoundContainers);
            
            document.getElementById('play-send-button').addEventListener('click', playSelectedSendSound);
            document.getElementById('play-receive-button').addEventListener('click', playSelectedReceiveSound);
            
            document.getElementById('send-custom-file').addEventListener('change', handleSendCustomFileSelect);
            document.getElementById('receive-custom-file').addEventListener('change', handleReceiveCustomFileSelect);
            
            document.getElementById('save-button').addEventListener('click', saveSettings);
            document.getElementById('back-button').addEventListener('click', () => window.close());
            
            // Инициализация отображения контейнеров пользовательских звуков
            updateCustomSoundContainers();
        });
    </script>
</body>
</html> 